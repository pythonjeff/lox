<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOX FUND | Live Dashboard</title>
    <meta name="description" content="Live performance metrics and portfolio dashboard for the LOX Fund.">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/icons8-chart-material-two-tone-32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/icons8-chart-material-two-tone-16.png') }}">
    
    <!-- Open Graph / Social Share -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="LOX FUND | Live Dashboard">
    <meta property="og:description" content="Live performance metrics and portfolio dashboard for the LOX Fund.">
    <meta property="og:image" content="{{ url_for('static', filename='images/sushi.jpg', _external=True) }}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LOX FUND | Live Dashboard">
    <meta name="twitter:description" content="Live performance metrics and portfolio dashboard for the LOX Fund.">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/sushi.jpg', _external=True) }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Chart.js + date adapter + annotation plugin for equity curve with regime bands -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.1.0/dist/chartjs-plugin-annotation.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Compact Header -->
        <header class="header-compact">
            <div class="header-left">
                <span class="logo-text">LOX</span>
                <span class="logo-fund">FUND</span>
            </div>
            <div class="header-right">
                <span class="live-indicator"><span class="live-dot"></span>LIVE</span>
                <span class="header-timestamp" id="header-timestamp">—</span>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('my_account') }}" class="btn-my-account" title="My Account">My Account</a>
                <form method="POST" action="{{ url_for('auth.logout') }}" class="logout-form">
                    <button type="submit" class="btn-logout" title="Sign out">Sign Out</button>
                </form>
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn-my-account" title="Investor Login">Investor Login</a>
                {% endif %}
            </div>
        </header>

        <!-- Regime Alert (hidden by default) -->
        <div class="regime-alert" id="regime-alert" style="display: none;">
            <span class="alert-icon">⚡</span>
            <span class="alert-text" id="alert-text">Regime shift detected</span>
            <button class="alert-dismiss" onclick="dismissAlert()">×</button>
        </div>

        <!-- HERO ZONE: Fund Return -->
        <section class="hero-zone">
            <div class="hero-label">FUND RETURN</div>
            <div class="hero-value" id="hero-return">—</div>
            <div class="hero-benchmark" id="hero-benchmark">—</div>
            <div class="hero-aum" id="hero-aum">—</div>
            <div class="hero-context">Since Jan 9, 2026</div>
        </section>

        <!-- Metrics Row -->
        <section class="metrics-row">
            <div class="metric-item">
                <div class="metric-label">Liquidation NAV<span class="info-tip" title="Longs at bid, shorts at ask">ⓘ</span></div>
                <div class="metric-value" id="nav-value">—</div>
            </div>
            <div class="metric-divider"></div>
            <div class="metric-item">
                <div class="metric-label">Unrealized P&L</div>
                <div class="metric-value" id="total-pnl">—</div>
            </div>
            <div class="metric-divider"></div>
            <div class="metric-item">
                <div class="metric-label">Cash</div>
                <div class="metric-value" id="cash-value">—</div>
            </div>
        </section>

        <!-- Accordion Sections -->
        <div class="accordion">
            
            <!-- Positions Section (with AI Thesis) -->
            <details class="accordion-section" open>
                <summary class="accordion-header">
                    <span class="accordion-title">Open Positions</span>
                    <div class="accordion-badges">
                        <span class="badge-label" id="positions-count">—</span>
                        <span class="badge-pnl" id="positions-pnl">—</span>
                    </div>
                </summary>
                <div class="accordion-content">
                    <div class="positions-list" id="positions-list">
                        <div class="loading">Loading positions...</div>
                    </div>
                </div>
            </details>

            <!-- Market Context Section (Enhanced with Resume Builder) -->
            <details class="accordion-section">
                <summary class="accordion-header">
                    <span class="accordion-title">Market Regime</span>
                    <div class="accordion-badges">
                        <span class="regime-badge" id="regime-badge">—</span>
                    </div>
                </summary>
                <div class="accordion-content">

                    <!-- FEATURE 5: Edge Summary Card -->
                    <div class="edge-card" id="edge-card" style="display:none;">
                        <div class="edge-card-header">
                            <span class="edge-card-icon">&#9670;</span>
                            <span class="edge-card-title">REGIME EDGE</span>
                        </div>
                        <div class="edge-stats">
                            <div class="edge-stat">
                                <span class="edge-stat-value" id="edge-alpha">—</span>
                                <span class="edge-stat-label">TWR vs S&P</span>
                            </div>
                            <div class="edge-stat">
                                <span class="edge-stat-value" id="edge-best-regime">—</span>
                                <span class="edge-stat-label" id="edge-best-detail">Best Environment</span>
                            </div>
                            <div class="edge-stat">
                                <span class="edge-stat-value" id="edge-win-rate">—</span>
                                <span class="edge-stat-label">Overall Win Rate</span>
                            </div>
                            <div class="edge-stat">
                                <span class="edge-stat-value" id="edge-anticipation">—</span>
                                <span class="edge-stat-label">Regime Reads</span>
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics Strip -->
                    <div class="regime-metrics">
                        <div class="regime-metric">
                            <span class="regime-metric-label">VIX</span>
                            <span class="regime-metric-value" id="vix-value">—</span>
                            <span class="regime-metric-context" id="vix-context">Fear gauge</span>
                        </div>
                        <div class="regime-metric">
                            <span class="regime-metric-label">HY Spread</span>
                            <span class="regime-metric-value" id="credit-value">—</span>
                            <span class="regime-metric-context" id="credit-context">Credit stress</span>
                        </div>
                        <div class="regime-metric">
                            <span class="regime-metric-label">10Y</span>
                            <span class="regime-metric-value" id="rates-value">—</span>
                            <span class="regime-metric-context" id="rates-context">Rate pressure</span>
                        </div>
                        <div class="regime-metric">
                            <span class="regime-metric-label">CPI</span>
                            <span class="regime-metric-value" id="cpi-value">—</span>
                            <span class="regime-metric-context" id="cpi-context">Inflation</span>
                        </div>
                        <div class="regime-metric">
                            <span class="regime-metric-label">2s10s</span>
                            <span class="regime-metric-value" id="curve-value">—</span>
                            <span class="regime-metric-context" id="curve-context">Yield curve</span>
                        </div>
                    </div>
                    
                    <!-- AI Insight Box -->
                    <div class="insight-box" id="insight-box">
                        <div class="insight-header">
                            <span class="insight-icon">&#127919;</span>
                            <span class="insight-title">Market Assessment</span>
                        </div>
                        <div class="insight-text" id="insight-text">Loading market analysis...</div>
                        <div class="insight-implication" id="insight-implication">
                            <span class="implication-label">Portfolio Implication:</span>
                            <span class="implication-text" id="implication-text">—</span>
                        </div>
                        <div class="insight-meta">
                            <span class="insight-tag">AI Analysis</span>
                            <span class="insight-time" id="insight-time">—</span>
                        </div>
                    </div>

                    <!-- Regime-Aware P&L Curve (from closed trades) -->
                    <div class="regime-chart-section" id="regime-chart-section" style="display:none;">
                        <div class="section-label">CUMULATIVE P&L BY REGIME</div>
                        <div class="regime-chart-wrap">
                            <canvas id="regime-equity-chart" height="220"></canvas>
                        </div>
                        <div class="regime-chart-legend" id="regime-chart-legend"></div>
                    </div>

                    <!-- Performance-by-Regime Attribution Table (enriched) -->
                    <div class="regime-perf-section" id="regime-perf-section" style="display:none;">
                        <div class="section-label">PERFORMANCE BY REGIME</div>
                        <table class="regime-perf-table">
                            <thead>
                                <tr>
                                    <th>Regime</th>
                                    <th>Trades</th>
                                    <th>Win Rate</th>
                                    <th>Avg Return</th>
                                    <th>Avg Hold</th>
                                    <th>P/C</th>
                                    <th>Total P&L</th>
                                </tr>
                            </thead>
                            <tbody id="regime-perf-body">
                            </tbody>
                        </table>
                    </div>

                </div>
            </details>

            <!-- Trade Performance Section -->
            <details class="accordion-section">
                <summary class="accordion-header">
                    <span class="accordion-title">Trade Performance</span>
                    <div class="accordion-badges">
                        <span class="badge-label" id="trade-stats">—</span>
                        <span class="badge-pnl" id="realized-pnl">—</span>
                    </div>
                </summary>
                <div class="accordion-content">
                    <!-- Sample Disclosure Banner -->
                    <div class="sample-disclosure" id="sample-disclosure" style="display: none;">
                        <span class="disclosure-icon">⚠️</span>
                        <span class="disclosure-text" id="sample-warning">—</span>
                        <span class="disclosure-range" id="date-range">—</span>
                    </div>
                    
                    <!-- Performance Metrics Panel -->
                    <div class="performance-metrics" id="performance-metrics">
                        <!-- Grade & Core Stats -->
                        <div class="perf-header">
                            <div class="perf-grade-box" id="perf-grade-box">
                                <span class="perf-grade-label">GRADE</span>
                                <span class="perf-grade" id="perf-grade">—</span>
                            </div>
                            <div class="perf-core-stats">
                                <div class="perf-stat" data-tooltip="Annualized Sharpe from equity curve returns">
                                    <span class="perf-stat-value" id="portfolio-sharpe">—</span>
                                    <span class="perf-stat-label">Sharpe (Ann.)</span>
                                </div>
                                <div class="perf-stat" data-tooltip="Gross Profit / Gross Loss. >2 is excellent">
                                    <span class="perf-stat-value" id="profit-factor">—</span>
                                    <span class="perf-stat-label">Profit Factor</span>
                                </div>
                                <div class="perf-stat" data-tooltip="Expected $ gain per trade">
                                    <span class="perf-stat-value" id="expectancy">—</span>
                                    <span class="perf-stat-label">Expectancy</span>
                                </div>
                                <div class="perf-stat" data-tooltip="Peak-to-trough decline in equity">
                                    <span class="perf-stat-value" id="max-drawdown">—</span>
                                    <span class="perf-stat-label">Max Drawdown</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Metrics Grid -->
                        <div class="perf-grid">
                            <div class="perf-card">
                                <div class="perf-card-title">Payoff Analysis</div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Avg Win</span>
                                    <span class="perf-row-value positive" id="avg-win">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Avg Loss</span>
                                    <span class="perf-row-value negative" id="avg-loss">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Payoff Ratio</span>
                                    <span class="perf-row-value" id="payoff-ratio">—</span>
                                </div>
                            </div>
                            
                            <div class="perf-card">
                                <div class="perf-card-title">Distribution</div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Std Dev (returns)</span>
                                    <span class="perf-row-value" id="pnl-std">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Skewness</span>
                                    <span class="perf-row-value" id="skewness">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Avg Hold Time</span>
                                    <span class="perf-row-value" id="avg-holding">—</span>
                                </div>
                            </div>
                            
                            <div class="perf-card">
                                <div class="perf-card-title">Extremes & Risk</div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Largest Win</span>
                                    <span class="perf-row-value positive" id="largest-win">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Largest Loss</span>
                                    <span class="perf-row-value negative" id="largest-loss">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Recovery Time</span>
                                    <span class="perf-row-value" id="recovery-days">—</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Secondary metrics row -->
                        <div class="perf-secondary">
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">R-Multiple:</span>
                                <span class="perf-secondary-value" id="r-multiple">—</span>
                            </span>
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">Kelly:</span>
                                <span class="perf-secondary-value" id="kelly-pct">—</span>
                            </span>
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">Win Streak:</span>
                                <span class="perf-secondary-value" id="max-wins">—</span>
                            </span>
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">Loss Streak:</span>
                                <span class="perf-secondary-value" id="max-losses">—</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Trade History Table -->
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Trade</th>
                                <th>Cost</th>
                                <th>Proceeds</th>
                                <th>P&L</th>
                            </tr>
                        </thead>
                        <tbody id="trades-body">
                            <tr><td colspan="4" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </details>

        </div>

        <!-- Footer -->
        <footer class="footer">
            <span class="footer-brand">LOX FUND</span>
            <span class="footer-dot">·</span>
            <span class="footer-time" id="footer-time">—</span>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
