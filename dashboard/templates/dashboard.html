<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOX FUND | Live Dashboard</title>
    <meta name="description" content="Live performance metrics and portfolio dashboard for the LOX Fund.">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/icons8-chart-material-two-tone-32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/icons8-chart-material-two-tone-16.png') }}">
    
    <!-- Open Graph / Social Share -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="LOX FUND | Live Dashboard">
    <meta property="og:description" content="Live performance metrics and portfolio dashboard for the LOX Fund.">
    <meta property="og:image" content="{{ url_for('static', filename='images/sushi.jpg', _external=True) }}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LOX FUND | Live Dashboard">
    <meta name="twitter:description" content="Live performance metrics and portfolio dashboard for the LOX Fund.">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/sushi.jpg', _external=True) }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=3">
    <!-- Chart.js (kept for potential future use) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Hamburger Nav Panel -->
    <div class="nav-scrim" id="nav-scrim"></div>
    <nav class="nav-panel" id="nav-panel">
        <div class="nav-panel-header">
            <span class="nav-brand">LOX FUND</span>
            <button class="nav-close" id="nav-close" aria-label="Close menu">&times;</button>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-item active">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                Dashboard
            </a>
            <a href="/lived-inflation" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                Lived Inflation Index
            </a>
            <div class="nav-group">
                <button class="nav-item nav-toggle" id="regimes-toggle" type="button">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><polyline points="7 16 11 10 15 13 21 5"/></svg>
                    Regimes
                    <svg class="nav-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div class="nav-sub-items" id="regimes-sub">
                    <a href="/regimes/growth" class="nav-sub-item">Growth</a>
                    <a href="/regimes/inflation" class="nav-sub-item">Inflation</a>
                    <a href="/regimes/volatility" class="nav-sub-item">Volatility</a>
                    <a href="/regimes/credit" class="nav-sub-item">Credit</a>
                    <a href="/regimes/rates" class="nav-sub-item">Rates</a>
                    <a href="/regimes/liquidity" class="nav-sub-item">Liquidity</a>
                    <a href="/regimes/consumer" class="nav-sub-item">Consumer</a>
                    <a href="/regimes/fiscal" class="nav-sub-item">Fiscal</a>
                    <a href="/regimes/usd" class="nav-sub-item">USD</a>
                    <a href="/regimes/commodities" class="nav-sub-item">Commodities</a>
                </div>
            </div>
            <a href="/my-account" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                My Account
            </a>
        </div>
    </nav>

    <div class="container">
        <!-- Compact Header -->
        <header class="header-compact">
            <div class="header-left">
                <button class="hamburger-btn" id="hamburger-btn" aria-label="Menu">
                    <span></span><span></span><span></span>
                </button>
                <div class="logo-group">
                    <span class="logo-text">LOX</span>
                    <span class="logo-fund">FUND</span>
                </div>
            </div>
            <div class="header-right">
                <span class="live-indicator"><span class="live-dot"></span>LIVE</span>
                <span class="header-timestamp" id="header-timestamp">—</span>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('my_account') }}" class="btn-my-account" title="My Account">My Account</a>
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn-my-account" title="Investor Login">Investor Login</a>
                {% endif %}
            </div>
        </header>

        <!-- HERO ZONE: Fund Return -->
        <section class="hero-zone">
            <div class="hero-label">FUND RETURN</div>
            <div class="hero-value" id="hero-return">—</div>
            <div class="hero-benchmark" id="hero-benchmark">—</div>
            <div class="hero-aum" id="hero-aum">—</div>
            <div class="hero-context">Since Jan 9, 2026</div>
        </section>

        <!-- Metrics Row -->
        <section class="metrics-row">
            <div class="metric-item">
                <div class="metric-label">NAV<span class="info-tip" title="Net asset value (longs at bid, shorts at ask)">ⓘ</span></div>
                <div class="metric-value" id="nav-value">—</div>
            </div>
            <div class="metric-divider"></div>
            <div class="metric-item">
                <div class="metric-label">Unrealized P&L</div>
                <div class="metric-value" id="total-pnl">—</div>
            </div>
            <div class="metric-divider"></div>
            <div class="metric-item">
                <div class="metric-label">Cash</div>
                <div class="metric-value" id="cash-value">—</div>
            </div>
        </section>

        <!-- Accordion Sections -->
        <div class="accordion">
            
            <!-- Positions Section (with AI Thesis) -->
            <details class="accordion-section">
                <summary class="accordion-header">
                    <span class="accordion-title">Open Positions</span>
                    <div class="accordion-badges">
                        <span class="badge-label" id="positions-count">—</span>
                        <span class="badge-pnl" id="positions-pnl">—</span>
                    </div>
                </summary>
                <div class="accordion-content">
                    <div class="positions-list" id="positions-list">
                        <div class="loading">Loading positions...</div>
                    </div>
                </div>
            </details>

            <!-- Trade Performance Section -->
            <details class="accordion-section">
                <summary class="accordion-header">
                    <span class="accordion-title">Trade Performance</span>
                    <div class="accordion-badges">
                        <span class="badge-label" id="trade-stats">—</span>
                        <span class="badge-pnl" id="realized-pnl">—</span>
                    </div>
                </summary>
                <div class="accordion-content">
                    <!-- Sample Disclosure Banner -->
                    <div class="sample-disclosure" id="sample-disclosure" style="display: none;">
                        <span class="disclosure-icon">⚠️</span>
                        <span class="disclosure-text" id="sample-warning">—</span>
                        <span class="disclosure-range" id="date-range">—</span>
                    </div>
                    
                    <!-- Performance Metrics Panel -->
                    <div class="performance-metrics" id="performance-metrics">
                        <!-- Grade & Core Stats -->
                        <div class="perf-header">
                            <div class="perf-grade-box" id="perf-grade-box">
                                <span class="perf-grade-label">GRADE</span>
                                <span class="perf-grade" id="perf-grade">—</span>
                            </div>
                            <div class="perf-core-stats">
                                <div class="perf-stat" data-tooltip="Annualized Sharpe from equity curve returns">
                                    <span class="perf-stat-value" id="portfolio-sharpe">—</span>
                                    <span class="perf-stat-label">Sharpe (Ann.)</span>
                                </div>
                                <div class="perf-stat" data-tooltip="Gross Profit / Gross Loss. >2 is excellent">
                                    <span class="perf-stat-value" id="profit-factor">—</span>
                                    <span class="perf-stat-label">Profit Factor</span>
                                </div>
                                <div class="perf-stat" data-tooltip="Expected $ gain per trade">
                                    <span class="perf-stat-value" id="expectancy">—</span>
                                    <span class="perf-stat-label">Expectancy</span>
                                </div>
                                <div class="perf-stat" data-tooltip="Peak-to-trough decline in equity">
                                    <span class="perf-stat-value" id="max-drawdown">—</span>
                                    <span class="perf-stat-label">Max Drawdown</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Metrics Grid -->
                        <div class="perf-grid">
                            <div class="perf-card">
                                <div class="perf-card-title">Payoff Analysis</div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Avg Win</span>
                                    <span class="perf-row-value positive" id="avg-win">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Avg Loss</span>
                                    <span class="perf-row-value negative" id="avg-loss">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Payoff Ratio</span>
                                    <span class="perf-row-value" id="payoff-ratio">—</span>
                                </div>
                            </div>
                            
                            <div class="perf-card">
                                <div class="perf-card-title">Distribution</div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Std Dev (returns)</span>
                                    <span class="perf-row-value" id="pnl-std">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Skewness</span>
                                    <span class="perf-row-value" id="skewness">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Avg Hold Time</span>
                                    <span class="perf-row-value" id="avg-holding">—</span>
                                </div>
                            </div>
                            
                            <div class="perf-card">
                                <div class="perf-card-title">Extremes & Risk</div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Largest Win</span>
                                    <span class="perf-row-value positive" id="largest-win">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Largest Loss</span>
                                    <span class="perf-row-value negative" id="largest-loss">—</span>
                                </div>
                                <div class="perf-card-row">
                                    <span class="perf-row-label">Recovery Time</span>
                                    <span class="perf-row-value" id="recovery-days">—</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Secondary metrics row -->
                        <div class="perf-secondary">
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">R-Multiple:</span>
                                <span class="perf-secondary-value" id="r-multiple">—</span>
                            </span>
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">Kelly:</span>
                                <span class="perf-secondary-value" id="kelly-pct">—</span>
                            </span>
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">Win Streak:</span>
                                <span class="perf-secondary-value" id="max-wins">—</span>
                            </span>
                            <span class="perf-secondary-item">
                                <span class="perf-secondary-label">Loss Streak:</span>
                                <span class="perf-secondary-value" id="max-losses">—</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Trade History Table -->
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Trade</th>
                                <th>Cost</th>
                                <th>Proceeds</th>
                                <th>P&L</th>
                            </tr>
                        </thead>
                        <tbody id="trades-body">
                            <tr><td colspan="4" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </details>

        </div>

        <!-- Footer -->
        <footer class="footer">
            <span class="footer-brand">LOX FUND</span>
            <span class="footer-dot">·</span>
            <span class="footer-time" id="footer-time">—</span>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='dashboard.js') }}?v=3"></script>
    <script>
    // Hamburger menu toggle
    (function() {
        const btn = document.getElementById('hamburger-btn');
        const panel = document.getElementById('nav-panel');
        const scrim = document.getElementById('nav-scrim');
        const closeBtn = document.getElementById('nav-close');
        function open() { document.body.classList.add('nav-open'); }
        function close() { document.body.classList.remove('nav-open'); }
        if (btn) btn.addEventListener('click', function() {
            document.body.classList.contains('nav-open') ? close() : open();
        });
        if (scrim) scrim.addEventListener('click', close);
        if (closeBtn) closeBtn.addEventListener('click', close);
        // Regimes sub-nav toggle
        var rt = document.getElementById('regimes-toggle');
        var rs = document.getElementById('regimes-sub');
        if (rt && rs) rt.addEventListener('click', function() {
            rt.classList.toggle('expanded');
            rs.classList.toggle('expanded');
        });
    })();
    </script>
</body>
</html>
